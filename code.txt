var tongDonHang = 0;
var tongTienDuocGiamMggShopee=0;
var tongTienDuocGiamMggShopeeShop=0;
var tongTienChiTieu = 0;
var tongTienTietKiem=0;
var tongTienHang = 0;
var tongTienVanChuyenChuaGiam = 0;
var tongTienVanChuyenDuocGiam = 0;
var tongSanPhamDaMua = 0;
var trangThaiDonHangConKhong = true;
var coin_earn = 0;
var offset = 0;
var si = 8;
var tongTienVanChuyenPhaiTra=0;
function xemBaoCaoThongKe() {
	var orders = [];
	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
			orders = JSON.parse(this.responseText)['orders'];
			tongDonHang += orders.length;
			trangThaiDonHangConKhong = orders.length >= si;
			orders.forEach(order => {
                let t3 = order["shipping_discount_subtotal"] / 100000;
                tongTienVanChuyenDuocGiam += t3;
                let t31 = order["shipping_subtotal_before_discount"] / 100000;
                tongTienVanChuyenChuaGiam += t31;
                let t4=order["merchandise_subtotal"] / 100000;
				tongTienHang+=t4;
				let t41=order["actual_price"] / 100000;
				tongTienChiTieu+=t41;
				let t2 = order["shipping_fee"] / 100000;
                tongTienVanChuyenPhaiTra += t2;
                order["items"].forEach(item => {
                    let t5 = item["amount"];
                    tongSanPhamDaMua += t5;
                });
                let t6=(order["payment_info"]["voucher_info"]["discount_by_shop_voucher"]||0)/100000;
                tongTienDuocGiamMggShopeeShop += t6;
                let t61=(order["payment_info"]["promotion_info"]["used_price"]||0)/100000;
                tongTienDuocGiamMggShopeeShop += t61;

                let t7=(order["payment_info"]["voucher_info"]["discount_by_shopee_voucher"]||0)/100000;
                tongTienDuocGiamMggShopee += t7;
		let t8=(order["payment_info"]["coin_info"]["coin_earn_by_shopee_voucher"]||0);
		coin_earn += t8;

			});
			offset += si;			
			if(trangThaiDonHangConKhong) {					
				console.log('ƒê√£ th·ªëng k√™ ƒë∆∞·ª£c: ' + tongDonHang + ' ƒë∆°n h√†ng. ƒêang l·∫•y th√™m d·ªØ li·ªáu....');
				xemBaoCaoThongKe();
			}
			else {
				tongTienHang=tongTienHang-(tongTienDuocGiamMggShopeeShop+tongTienDuocGiamMggShopee);
				tongTienTietKiem=tongTienDuocGiamMggShopee+tongTienDuocGiamMggShopeeShop+tongTienVanChuyenDuocGiam;
				var tongTienChiTieuX=pxgPrice(tongTienChiTieu);
				console.log("================================");
				console.log("%c"+PXGCert(tongTienChiTieu), "font-size:26px;");
				console.log("%cS·ªë ti·ªÅn b·∫°n ƒê√É ƒê·ªêT v√†o Shopee l√†: "+"%c"+tongTienChiTieuX+" vnƒë%c", "font-size: 20px;","font-size: 26px; color:orange;font-weigth:700", "font-size: 20px;");
				console.log("================================");
				console.log("%cT·ªïng ƒë∆°n h√†ng ƒë√£ giao: "+"%c"+pxgPrice(tongDonHang)+" ƒë∆°n h√†ng", "font-size: 20px;","font-size: 20px; color:green");
                console.log("%cT·ªïng s·∫£n ph·∫©m ƒë√£ ƒë·∫∑t: " + "%c" + pxgPrice(tongSanPhamDaMua)+" s·∫£n ph·∫©m", "font-size: 20px;","font-size: 20px; color:#fc0000");
				console.log("%cT·ªïng ti·ªÅn h√†ng + ph√≠ v·∫≠n chuy·ªÉn khi CH∆ØA S·ª¨ D·ª§NG c√°c lo·∫°i voucher: "+"%c"+pxgPrice(tongTienChiTieu+tongTienTietKiem)+" vnƒë", "font-size: 24px;","font-size: 24px; color:orange;font-weigth:700");
				console.log("%cT·ªïng ti·ªÅn h√†ng khi ch∆∞a d√πng M√£ gi·∫£m gi√°: "+"%c"+pxgPrice(tongTienChiTieu+tongTienTietKiem-tongTienVanChuyenChuaGiam)+" vnƒë", "font-size: 18px;","font-size: 18px; color:#fc0000");
				console.log("%cT·ªïng ti·ªÅn ph√≠ v·∫≠n chuy·ªÉn khi ch∆∞a d√πng m√£ Freeship: "+"%c"+pxgPrice(tongTienVanChuyenChuaGiam)+" vnƒë", "font-size: 18px;","font-size: 18px; color:#fc0000");
				console.log("================================");
				console.log("%cT·ªïng ti·ªÅn h√†ng + ph√≠ v·∫≠n chuy·ªÉn khi ƒê√É S·ª¨ D·ª§NG c√°c lo·∫°i voucher: "+"%c"+tongTienChiTieuX+" vnƒë%c", "font-size: 24px;","font-size: 24px; color:orange;font-weigth:700", "font-size: 20px;");
                console.log("%cT·ªïng ti·ªÅn ph√≠ v·∫≠n chuy·ªÉn ƒë√£ tr·∫£: "+"%c"+pxgPrice(tongTienVanChuyenPhaiTra)+" vnƒë", "font-size: 20px;","font-size: 20px; color:#fc0000");
				console.log("%c(1)T·ªïng ti·ªÅn ph√≠ v·∫≠n chuy·ªÉn ti·∫øt ki·ªám ƒë∆∞·ª£c nh·ªù √°p M√£ Freeship: "+"%c"+pxgPrice(tongTienVanChuyenDuocGiam)+" vnƒë", "font-size: 18px;","font-size: 18px; color:green");
				console.log("%c(2)T·ªïng ti·ªÅn TI·∫æT KI·ªÜM ƒë∆∞·ª£c nh·ªù √°p M√£ gi·∫£m gi√° Shopee: "+"%c"+pxgPrice(tongTienDuocGiamMggShopee)+" vnƒë", "font-size: 18px;","font-size: 18px; color:green");
				console.log("%c(3)T·ªïng ti·ªÅn TI·∫æT KI·ªÜM ƒë∆∞·ª£c nh·ªù d√πng Voucher c·ªßa Shop: "+"%c"+pxgPrice(tongTienDuocGiamMggShopeeShop)+" vnƒë", "font-size: 18px;","font-size: 18px; color:green");
				console.log("%c(4)T·ªïng Xu nh·∫≠n ƒë∆∞·ª£c nh·ªù d√πng M√£ ho√†n xu Shopee: "+"%c"+pxgPrice(coin_earn)+" xu", "font-size: 18px;","font-size: 18px; color:green;font-weigth:700");
				console.log("%cüí∞T·ªîNG TI·∫æT KI·ªÜM(1+2+3+4): "+"%c"+pxgPrice(tongTienTietKiem+coin_earn)+" vnƒë", "font-size: 24px;","font-size: 24px; color:orange;font-weigth:700");
				console.log("================================");
			}
		}
	};
	xhttp.open("GET", "https://shopee.vn/api/v1/orders/?order_type=3&offset="+offset+"&limit="+si, true);
	xhttp.send();
}
function PXGCert(pri){
  if(pri<=10000000){
  	return "H√äN QU√Å! B·∫†N CH∆ØA B·ªä SHOPEE G√ÇY NGHI·ªÜN üòç";
  }else if(pri>10000000 &&pri<=50000000){
  	return "TH√îI XONG! B·∫†N B·∫ÆT ƒê·∫¶U NGHI·ªÜN SHOPEE R·ªíI üòÇ";
  }else if(pri>50000000 &&pri<80000000){
  	return "·ªêI GI·ªúI ∆†I! B·∫†N L√Ä CON NGHI·ªÜN SHOPEE CH√çNH HI·ªÜU üò±";
  }else{
  	return "X√ìA APP SHOPEE TH√îI! B·∫†N NGHI·ªÜN SHOPEE N·∫∂NG QU√Å R·ªíI üòù";
  }
}
function pxgPrice(number, fixed=0) {
	if(isNaN(number)) return 0;
	number = number.toFixed(fixed);
	let delimeter = ',';
	number += '';
	let rgx = /(\d+)(\d{3})/;
	while (rgx.test(number)) {
		number = number.replace(rgx, '$1' + delimeter + '$2');
	}
	return number;
}
xemBaoCaoThongKe();